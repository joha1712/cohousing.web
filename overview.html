<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bofællesskab</title>
    <link rel="stylesheet" href="styles/bulma/darkly/bulmaswatch_v0.7.1.min.css">
    <link rel="stylesheet" href="styles/bulma/bulma-extensions.min.css">
    <link rel="stylesheet" href="styles/datepicker/flatpickr.dark.min.css">      
    <link rel="stylesheet" href="styles/style.css">
        
    <script src="scripts/axios/axios_v0.18.0.js"></script>
    <script defer src="scripts/fontawesome/fontawesome_solid_v5.11.2.min.js"></script>    
    <script defer src="scripts/fontawesome/fontawesome_v5.11.2.min.js"></script>   
    <script src="scripts/vue/vue_v2.5.16.js"></script>
    <script src="scripts/datepicker/flatpickr.min.js"></script>
    <script src="scripts/datepicker/flatpickr.da.min.js"></script>
      
    <script src="config.js"> type="module"</script>
    
  </head>
  
  <body class="is-clipped">
    <div id="app"> 
        
        <div class="container">
           
            <section class ="section">
                <div class="container has-text-centered">
                    <h1 class="title is-hidden-mobile-bottommarginfix">
                        <a href="javascript:window.location.href=window.location.href">{{ pageTitle }}</a>
                    </h1>
                    <p class="subtitle is-hidden-mobile">
                        <a href="javascript:window.location.href=window.location.href">{{ pageSubtitle }}</a>
                    </p>
                </div>
            </section>
            
            <section class="section">
                <div class="columns is-centered">
                    
                    <div class="column is-three-fifths has-text-centered">

                        <div class="field is-horizontal">                          
                            
                            <div class="field-body" style="">
                                <div class="field is-narrow">
                                    <p class="control ">
                                        <input id="fromDate" class="input" type="date" v-model.lazy="this.fromDate" placeholder="Fra dato">                                
                                    </p>
                                </div>
                                <div class="field is-narrow">
                                    <p class="control">
                                        <input id="toDate" class="input" type="date" v-model.lazy="this.toDate" placeholder="Til dato">                                
                                    </p>
                                </div>
                                <div class="field is-narrow">
                                    <p class="control">
                                        <button id="update" class="button is-success" @click="loadStatistics(fromDate,toDate)">Opdater</button>
                                    </p>
                                </div>
                            </div>
                        </div>
                
                                           
                        <table class="table is-striped">
                            <thead>                    
                                <tr>
                                    <th>Navn</th>
                                    <th>Kok</th>
                                    <th>Deltager</th>
                                    <th>Gæster (voksne)</th>
                                    <th>Gæster (børn)</th>
                                    <th>Beløb for mad</th>
                                    <th>Udlæg for mad</th>
                                    <th>Netto</th>         
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="row in this.overview">
                                    <td>{{ row.personName }}</td>
                                    <td>{{ row.chefCount }}</td>
                                    <td>{{ row.mealCount }}</td>
                                    <td>{{ row.adultGuests }}</td>
                                    <td>{{ row.childGuests }}</td>
                                    <td>{{ row.mealCostSum }}</td>
                                    <td>{{ row.expensesSum }} </td>
                                    <td>{{ row.nettoSum }} </td>
                                </tr>                                            
                            </tbody>
                        </table>                        
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script type="text/javascript">
             
        let vm = new Vue({            
            el: '#app',
            data: {
                pageTitle: "Buske bofællesskab",
                pageSubtitle : "Fællesmad oversigt",
                overview : null,
                fromDate : null,
                toDate: null
            },
            methods : {
                loadStatistics(fromDate, toDate) {                    
                    axios
                        .get(`${baseApiUrl}/commonmeals/statistics/overview`,
                            {
                                params : {
                                    fromDate: fromDate,
                                    toDate: toDate
                                }
                            })
                        .then(response => { 
                            let d = response.data; 
                            this.overview = d.rows;
                            this.fromDate = d.fromDate.split("T").shift();                                                              
                            this.toDate = d.toDate.split("T").shift();
                            this.pageTitle = d.title,
                            this.pageSubtitle = d.subtitle 
                        })
                        .catch(e => {
                            alert(`Error fetching statistics: ${e}`);
                                console.log(e);
                        });                    
                },

            },
            created() {
                this.loadStatistics();                           
            },
            mounted() {
                var vm = this;
                flatpickr.localize(flatpickr.l10ns.da);
                flatpickr("#fromDate", { weekNumbers: true, onChange: function(a,b) { vm.fromDate = b }});
                flatpickr("#toDate", { weekNumbers: true, onChange: function(a,b) { vm.toDate = b }});
            }
        });
    </script>
  </body>
</html>